'use strict';
// Flat i18n dictionary for UI strings (DE/EN).
const I18N = {
    de: {
        buttons: {
            moreDetails: 'Weitere Details',
            markPageAsSeen: 'Seite als gesehen markieren',
            markAllAsSeen: 'Alle als gesehen markieren',
            backToTop: 'Zum Seitenanfang',
            settingsTab: 'AVE Einstellungen',
            favorites: 'Favoriten',
            newEntries: 'Neue Einträge',
        },
        badges: {
            preRelease: 'Vorabversion',
            featured: 'Empfohlen',
        },
        notifications: {
            nothingToSee: 'Hier gibt es nix zu sehen.\nZumindest noch nicht :P',
            copySuccess: 'Text wurde in die Zwischenablage kopiert.',
            copyError: 'Fehler beim Kopieren in die Zwischenablage:',
            unseenItemsTitle: (version) => `Amazon Vine Explorer - ${version}`,
            unseenItemsBody: (count) => `Es wurden ${count} neue Eintraege gefunden`,
        },
        share: {
            myFSE: 'Mein FSE',
            availableAll: 'Verfügbar für Alle',
            additional: 'Zusätzliche Artikel',
            page: 'Seite:',
        },
        settings: {
            header: (title, version) => `Einstellungen ${title} - Version ${version}`,
            languageLabel: 'Sprache'
        },
        settingsLabels: {
            UI_LANGUAGE: 'Sprache',
            EnableFullWidth: 'Volle Breite aktivieren',
            DarkMode: 'Dark Mode aktivieren (Reload erforderlich)',
            DisableAmazonNavbar: 'Amazon Navbar deaktivieren',
            DisableCategories: 'Kategorien deaktivieren',
            DisableFooter: 'Footer deaktivieren',
            DisableSuggestions: 'Vorschläge deaktivieren',
            DisableBtnPotLuck: 'Button Potluck deaktivieren',
            DisableBtnLastChance: 'Button Last Chance deaktivieren',
            DisableBtnSeller: 'Button Seller deaktivieren',
            EnableTopLogoChange: 'Top-Logo ändern aktivieren',
            EnableBtnAll: 'Button Alle Produkte aktivieren',
            EnablePaginationTop: 'Paginierung oben aktivieren',
            EnableBackgroundScan: 'Background Scan aktivieren',
            EnableInfiniteScrollLiveQuerry: 'Infinite Scroll Live-Query aktivieren',
            EnableDesktopNotifikation: 'Desktop-Benachrichtigungen aktivieren',
            EnableAutoMarkFavorite: 'Auto-Favorit markieren aktivieren',
            EnableCleanupFavorites: 'Favoriten bei Cleanup löschen',
            EnableBtnMarkAllAsSeen: 'Button Alles als gesehen markieren',
            ShowFirstSeen: 'Erst gesehen statt zuletzt gesehen',
            DesktopNotifikationKeywords: 'Desktop-Benachrichtigung Keywords',
            GotifyUrl: 'URL des Gotify-Servers',
            GotifyToken: 'Gotify Anwendungstoken',
            BackGroundScanDelayPerPage: 'Background Scan Min. Delay pro Seite (ms)',
            BackGroundScannerRandomness: 'Background Scan Randomness pro Seite (ms)',
            DesktopNotifikationDelay: 'Desktop-Benachrichtigung Delay (Sek.)',
            SearchBarInputDelay: 'Suchleiste Verzögerung (ms)',
            IdlePeriodAfterScan: 'Wartezeit nach Scan (Min.)',
            HoursBeforeCleanup: 'Stunden bis Cleanup',
            MaxItemsPerPage: 'Maximale Items pro Seite',
            UnseenItemsNotificationThreshold: 'Schwellwert ungesehene Items',
            UnseenItemsNotificationRepitionMinutes: 'Wartezeit ungesehene Items (Min.)',
            NewItemsNotificationThreshold: 'Schwellwert neue Items',
            NewItemsNotificationRepititionMinutes: 'Wartezeit neue Items (Min.)',
            BtnColorNewProducts: 'Button-Farbe Neue Produkte',
            BtnColorNewProductsBadge: 'Badge-Farbe Neue Produkte',
            BtnColorMarkCurrSiteAsSeen: 'Button-Farbe Seite als gesehen',
            BtnColorMarkAllAsSeen: 'Button-Farbe Alles als gesehen',
            BtnColorBackToTop: 'Button-Farbe Nach oben',
            BtnColorUpdateDB: 'Button-Farbe DB aktualisieren',
            BtnColorAllProducts: 'Button-Farbe Alle Produkte',
            BtnColorFavorites: 'Button-Farbe Favoriten',
            BtnColorFavoritesBadge: 'Badge-Farbe Favoriten',
            FavStarColorDefault: 'Farbe Favoritenstern (aus)',
            FavStarColorChecked: 'Farbe Favoritenstern (an)',
            DarkModeBackgroundColor: 'Dark Mode Hintergrundfarbe',
            DarkModeColor: 'Dark Mode Textfarbe',
            DisableFooterShopping: 'Shopping Footer deaktivieren',
            DisableSuggestionsShopping: 'Shopping Vorschläge deaktivieren',
            DebugLevel: 'Debuglevel',
            TITLE_AMAZON_VINE: 'Amazon Vine',
            TITLE_COLORS: 'Farben und Styles',
            TITLE_SHOPPING: 'Amazon Shopping',
            TITLE_DEV: 'Einstellungen für Entwickler und Tester',
            BUTTON_RESET_SETTINGS: 'Einstellungen zurücksetzen',
            BUTTON_DB_EXPORT: 'Datenbank exportieren >>>',
            BUTTON_DB_IMPORT: 'Datenbank importieren <<<',
            BUTTON_DB_DELETE: 'Datenbank löschen'
        },
        settingsDescriptions: {
            UI_LANGUAGE: 'Wähle deine bevorzugte Sprache für die UI',
            EnableFullWidth: 'Nutzt die volle Breite des Displays',
            DarkMode: 'Wechselt zwischen Amazon Light Theme und AVE Dark Mode (Reload erforderlich)',
            DisableAmazonNavbar: 'Deaktiviert die Amazon Navbar',
            DisableCategories: 'Deaktiviert die Kategorien der Amazon Vine Seite',
            DisableFooter: 'Deaktiviert den Footer der Amazon Vine Seite',
            DisableSuggestions: 'Deaktiviert Vorschläge auf der Amazon Vine Seite',
            DisableBtnPotLuck: 'Deaktiviert den Abschnitts-Button PotLuck (FSE)',
            DisableBtnLastChance: 'Deaktiviert den Abschnitts-Button Last Chance (VFA)',
            DisableBtnSeller: 'Deaktiviert den Abschnitts-Button Seller (ZA)',
            EnableTopLogoChange: 'Aktiviert das AVE-Logo im Kopfbereich',
            EnableBtnAll: 'Aktiviert den Button "Alle Produkte"',
            EnablePaginationTop: 'Zeigt Paginierung oben für ZA-Seite',
            EnableBackgroundScan: 'Aktiviert den Background Scan',
            EnableInfiniteScrollLiveQuerry: 'Wenn aktiv, werden Produkte live von Amazon geladen',
            EnableDesktopNotifikation: 'Aktiviert Desktop-Benachrichtigungen für neue Produkte',
            EnableAutoMarkFavorite: 'Markiert neue Produkte automatisch als Favorit, wenn Keywords matchen',
            EnableCleanupFavorites: 'Favoriten werden beim Cleanup ebenfalls entfernt',
            EnableBtnMarkAllAsSeen: 'Aktiviert den Button "Alles als gesehen markieren"',
            ShowFirstSeen: 'Zeigt "erst gesehen" statt "zuletzt gesehen"',
            DesktopNotifikationKeywords: 'Liste der Highlight-Keywords',
            GotifyUrl: 'URL deines Gotify-Servers (z.B. https://gotify.example.com)',
            GotifyToken: 'Authentifizierungs-Token deiner Gotify-App',
            BackGroundScanDelayPerPage: 'Minimale Verzögerung pro Seite beim Background Scan',
            BackGroundScannerRandomness: 'Maximale zufällige Verzögerung pro Seite',
            DesktopNotifikationDelay: 'Mindestzeit zwischen Benachrichtigungen (0 = deaktiviert)',
            SearchBarInputDelay: 'Suchstart nach Inaktivität in der Suchleiste',
            IdlePeriodAfterScan: 'Wartezeit bis zum nächsten Scan',
            HoursBeforeCleanup: 'Wenn ein Item so lange nicht gesehen wurde, wird es entfernt',
            MaxItemsPerPage: 'Maximale Anzahl Items pro Seite',
            UnseenItemsNotificationThreshold: 'Schwellwert für ungesehene Items',
            UnseenItemsNotificationRepitionMinutes: 'Wartezeit zwischen ungesehenen Benachrichtigungen',
            NewItemsNotificationThreshold: 'Schwellwert für neue Items',
            NewItemsNotificationRepititionMinutes: 'Wartezeit zwischen neuen Benachrichtigungen',
            DisableFooterShopping: 'Deaktiviert den Footer der Amazon Shopping Seite',
            DisableSuggestionsShopping: 'Deaktiviert Vorschläge auf der Amazon Shopping Seite',
            BUTTON_RESET_SETTINGS: 'Setzt alle Einstellungen auf Standard zurück',
            BUTTON_DB_EXPORT: 'Exportiert die komplette Datenbank',
            BUTTON_DB_IMPORT: 'Löscht die Datenbank und importiert eine Datei (ohne Validierung)',
            BUTTON_DB_DELETE: 'Nur zu Entwicklungszwecken: löscht die komplette Datenbank',
            TITLE_AMAZON_VINE: 'Einstellungen für Amazon Vine',
            TITLE_COLORS: 'Farben und Styles',
            TITLE_SHOPPING: 'Einstellungen für Amazon Shopping',
            TITLE_DEV: 'Einstellungen für Entwickler und Tester',
            BtnColorNewProducts: 'Farbe für den Button "Neue Einträge"',
            BtnColorNewProductsBadge: 'Farbe für das Badge "Neue Einträge"',
            BtnColorMarkCurrSiteAsSeen: 'Farbe für den Button "Seite als gesehen"',
            BtnColorMarkAllAsSeen: 'Farbe für den Button "Alle als gesehen"',
            BtnColorBackToTop: 'Farbe für den Button "Nach oben"',
            BtnColorUpdateDB: 'Farbe für den Button "Datenbank aktualisieren"',
            BtnColorAllProducts: 'Farbe für den Button "Alle Produkte"',
            BtnColorFavorites: 'Farbe für den Button "Favoriten"',
            BtnColorFavoritesBadge: 'Farbe für das Badge "Favoriten"',
            FavStarColorDefault: 'Farbe für den Favoritenstern (aus)',
            FavStarColorChecked: 'Farbe für den Favoritenstern (an)',
            DarkModeBackgroundColor: 'Hintergrundfarbe für Dark Mode',
            DarkModeColor: 'Textfarbe für Dark Mode',
            DebugLevel: 'Debug-Ausgabe-Level (0-15)'
        },
        settingsPlaceholders: {
            DesktopNotifikationKeywords: 'Gib deine Highlight-Keywords ein, eins pro Zeile, und klick außerhalb'
        }
    },
    en: {
        buttons: {
            moreDetails: 'More Details',
            markPageAsSeen: 'Mark page as seen',
            markAllAsSeen: 'Mark all as seen',
            backToTop: 'Back to top',
            settingsTab: 'AVE Settings',
            favorites: 'Fav',
            newEntries: 'New',
        },
        badges: {
            preRelease: 'Pre-release',
            featured: 'Featured',
        },
        notifications: {
            nothingToSee: 'Nothing to see here.\nAt least not yet :P',
            copySuccess: 'Text copied to clipboard',
            copyError: 'Error copying to clipboard:',
            unseenItemsTitle: (version) => `Amazon Vine Explorer - ${version}`,
            unseenItemsBody: (count) => `${count} new entries found`,
        },
        share: {
            myFSE: 'My FSE',
            availableAll: 'Available for All',
            additional: 'Additional Items',
            page: 'Page:',
        },
        settings: {
            header: (title, version) => `Settings ${title} - Version ${version}`,
            languageLabel: 'Language'
        },
        settingsLabels: {
            UI_LANGUAGE: 'Language',
            EnableFullWidth: 'Enable Full Width',
            DarkMode: 'Enable Dark Mode (reload required)',
            DisableAmazonNavbar: 'Disable Amazon Navbar',
            DisableCategories: 'Disable Categories',
            DisableFooter: 'Disable Footer',
            DisableSuggestions: 'Disable Suggestions',
            DisableBtnPotLuck: 'Disable Button Potluck',
            DisableBtnLastChance: 'Disable Button Last Chance',
            DisableBtnSeller: 'Disable Button Seller',
            EnableTopLogoChange: 'Enable Top Logo Change',
            EnableBtnAll: 'Enable Button All Products',
            EnablePaginationTop: 'Enable Pagination on top',
            EnableBackgroundScan: 'Enable Background Scan',
            EnableInfiniteScrollLiveQuerry: 'Enable Infinite Scroll Live Query',
            EnableDesktopNotifikation: 'Enable Desktop Notifications',
            EnableAutoMarkFavorite: 'Enable auto marking product as favorite',
            EnableCleanupFavorites: 'Also remove favorites when cleaning up products',
            EnableBtnMarkAllAsSeen: 'Enable Button Mark all as seen',
            ShowFirstSeen: 'Show first seen instead of last seen',
            DesktopNotifikationKeywords: 'Desktop Notification Highlight Keywords',
            GotifyUrl: 'URL of the Gotify Server',
            GotifyToken: 'Gotify application token',
            BackGroundScanDelayPerPage: 'Background Scan Per Page Min Delay (ms)',
            BackGroundScannerRandomness: 'Background Scan Randomness per Page (ms)',
            DesktopNotifikationDelay: 'Desktop Notification Delay (Seconds)',
            SearchBarInputDelay: 'Search Bar Input Delay (ms)',
            IdlePeriodAfterScan: 'Idle period after a scan',
            HoursBeforeCleanup: 'Hours before cleanup',
            MaxItemsPerPage: 'Maximum items per page',
            UnseenItemsNotificationThreshold: 'Unseen items notification threshold',
            UnseenItemsNotificationRepitionMinutes: 'Minutes between unseen item notifications',
            NewItemsNotificationThreshold: 'New items notification threshold',
            NewItemsNotificationRepititionMinutes: 'Minutes between new item notifications',
            BtnColorNewProducts: 'Button Color New Products',
            BtnColorNewProductsBadge: 'Button Color New Products Badge',
            BtnColorMarkCurrSiteAsSeen: 'Button Color Mark Current Site As Seen',
            BtnColorMarkAllAsSeen: 'Button Color Mark All As Seen',
            BtnColorBackToTop: 'Button Color Back To Top',
            BtnColorUpdateDB: 'Button Color Update Database',
            BtnColorAllProducts: 'Button Color All Products',
            BtnColorFavorites: 'Button Color Favorites',
            BtnColorFavoritesBadge: 'Button Color Favorites Badge',
            FavStarColorDefault: 'Color Favorite Star unchecked',
            FavStarColorChecked: 'Color Favorite Star checked',
            DarkModeBackgroundColor: 'Dark Mode Background Color',
            DarkModeColor: 'Dark Mode Text Color',
            DisableFooterShopping: 'Disable Footer (Shopping)',
            DisableSuggestionsShopping: 'Disable Suggestions (Shopping)',
            DebugLevel: 'Debug level',
            TITLE_AMAZON_VINE: 'Amazon Vine',
            TITLE_COLORS: 'Colors and Styles',
            TITLE_SHOPPING: 'Amazon Shopping',
            TITLE_DEV: 'Settings for Developers and Testers',
            BUTTON_RESET_SETTINGS: 'RESET SETTINGS TO DEFAULT',
            BUTTON_DB_EXPORT: 'DATABASE EXPORT >>>',
            BUTTON_DB_IMPORT: 'DATABASE IMPORT <<<',
            BUTTON_DB_DELETE: 'DELETE DATABASE'
        },
        settingsDescriptions: {
            UI_LANGUAGE: 'Choose your preferred language for the UI',
            EnableFullWidth: 'Uses the full width of the display',
            DarkMode: 'Switches between Amazon Light Theme and AVE Dark Mode (reload required)',
            DisableAmazonNavbar: 'Disables the Amazon Navbar',
            DisableCategories: 'Disables the Categories of the Amazon Vine Page',
            DisableFooter: 'Disables the Footer of the Amazon Vine Page',
            DisableSuggestions: 'Disables Suggestions on the Amazon Vine Page',
            DisableBtnPotLuck: 'Disables the Section Button PotLuck (FSE)',
            DisableBtnLastChance: 'Disables the Section Button Last Chance (VFA)',
            DisableBtnSeller: 'Disables the Section Button Seller (ZA)',
            EnableTopLogoChange: 'Enables the Change of the top logo to our AVE Logo',
            EnableBtnAll: 'Enable "All Products" Button',
            EnablePaginationTop: 'Enable Pagination to be displayed on top for ZA page',
            EnableBackgroundScan: 'Enables the Background scan',
            EnableInfiniteScrollLiveQuerry: 'If enabled, products are queried directly from Amazon',
            EnableDesktopNotifikation: 'Enable Desktop Notifications if new Products are detected',
            EnableAutoMarkFavorite: 'Automatically mark new products as favorite when keywords match',
            EnableCleanupFavorites: 'Also remove favorites during cleanup based on criteria',
            EnableBtnMarkAllAsSeen: 'Enable the Button Mark all as seen',
            ShowFirstSeen: 'Show the time an item was first seen',
            DesktopNotifikationKeywords: 'Create a list of highlight keywords',
            GotifyUrl: 'If Gotify is used, enter the URL of your server (e.g. https://gotify.example.com)',
            GotifyToken: 'Authentication token of your Gotify application',
            BackGroundScanDelayPerPage: 'Minimal delay per page load of Background Scan',
            BackGroundScannerRandomness: 'Max random delay added per page load',
            DesktopNotifikationDelay: 'Minimal time between desktop notifications (0 disables)',
            SearchBarInputDelay: 'Start searching when no key pressed for this time',
            IdlePeriodAfterScan: 'Minutes to wait until next scan starts',
            HoursBeforeCleanup: 'Items not seen this many hours get removed',
            MaxItemsPerPage: 'Maximum items shown per page',
            UnseenItemsNotificationThreshold: 'Threshold to trigger unseen items notification',
            UnseenItemsNotificationRepitionMinutes: 'Minutes to wait before another unseen notification',
            NewItemsNotificationThreshold: 'Threshold to trigger possible drop notification',
            NewItemsNotificationRepititionMinutes: 'Minutes to wait before another drop notification',
            DisableFooterShopping: 'Disables the Footer of the Amazon Shopping Page',
            DisableSuggestionsShopping: 'Disables the Suggestions of the Amazon Shopping Page',
            BUTTON_RESET_SETTINGS: 'Resets settings to defaults',
            BUTTON_DB_EXPORT: 'Export the entire Database',
            BUTTON_DB_IMPORT: 'Clear database and import data (no validation)',
            BUTTON_DB_DELETE: 'Delete the entire database (dev only)',
            TITLE_AMAZON_VINE: 'Settings for Amazon Vine',
            TITLE_COLORS: 'Colors and styles settings',
            TITLE_SHOPPING: 'Settings for Amazon Shopping',
            TITLE_DEV: 'Settings for developers and testers',
            BtnColorNewProducts: 'Color for the "New Entries" button',
            BtnColorNewProductsBadge: 'Color for the "New Entries" badge',
            BtnColorMarkCurrSiteAsSeen: 'Color for the "Mark page as seen" button',
            BtnColorMarkAllAsSeen: 'Color for the "Mark all as seen" button',
            BtnColorBackToTop: 'Color for the "Back to top" button',
            BtnColorUpdateDB: 'Color for the "Update Database" button',
            BtnColorAllProducts: 'Color for the "All Products" button',
            BtnColorFavorites: 'Color for the "Favorites" button',
            BtnColorFavoritesBadge: 'Color for the "Favorites" badge',
            FavStarColorDefault: 'Color for the favorite star (unchecked)',
            FavStarColorChecked: 'Color for the favorite star (checked)',
            DarkModeBackgroundColor: 'Background color for Dark Mode',
            DarkModeColor: 'Text color for Dark Mode',
            DebugLevel: 'Debug output level (0-15)'
        },
        settingsPlaceholders: {
            DesktopNotifikationKeywords: 'Type in your highlight keywords one per line and click outside to submit'
        }
    }
};

// Resolve current UI language from settings, with a safe fallback.
function detectLanguage() {
    if (!SETTINGS || typeof SETTINGS.UI_LANGUAGE === 'undefined') {
        return 'de';
    }
    const userLang = SETTINGS.UI_LANGUAGE || 'de';
    if (userLang === 'de' || userLang === 'en') return userLang;
    return 'de';
}

// Translation lookup with optional formatter functions.
function t(category, key, ...args) {
    const lang = detectLanguage();
    if (!I18N[lang] || !I18N[lang][category]) {
        console.warn(`Translation missing for category: ${category}`);
        return key || '';
    }
    const message = I18N[lang][category][key];
    if (!message) {
        console.warn(`Translation missing for key: ${category}.${key}`);
        return key || '';
    }
    if (typeof message === 'function') {
        return message(...args);
    }
    return message;
}
